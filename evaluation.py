from utils import sample
from keras.models import load_model
import sys
import io



def generate_output(model, sequence):
    """
    model: instance of pretrained model

    sequence: character generated by generated_output
    
    """
    generated = ''
    usr_input = input("Write the beginning of your poem, the Shakespeare machine will complete it. Your input is: ")
    sentence = ('{0:0>' + str(Tx) + '}').format(usr_input).lower()
    generated += usr_input 

    sys.stdout.write("\n\nHere is your poem: \n\n") 
    sys.stdout.write(usr_input)
    for i in range(sequence):

        x_pred = np.zeros((1, Tx, len(chars)))

        for t, char in enumerate(sentence):
            if char != '0':
                x_pred[0, t, char_indices[char]] = 1.

        preds = model.predict(x_pred, verbose=0)[0]
        next_index = sample(preds, temperature = 1.0)
        next_char = indices_char[next_index]

        generated += next_char
        sentence = sentence[1:] + next_char

        sys.stdout.write(next_char)
        sys.stdout.flush()

        if next_char == '\n':
            continue

if __name__=='__main__':

    model=load_model('Model_checkpoints/model.h5')
    text = io.open('Model_data/shakespear.txt', encoding='utf-8').read().lower()

    chars = sorted(list(set(text)))
    Tx=40
    char_indices = dict((c, i) for i, c in enumerate(chars))
    indices_char = dict((i, c) for i, c in enumerate(chars))

    generate_output(model, 100)

